---
/**
 * TRACKWISE - Main Layout
 * Optimized for SEO with comprehensive meta tags and i18n support
 */
import type { SEOProps } from '@/types';
import '@/styles/global.css';
import { languages, getLangFromUrl, getAlternateLinks, type Language } from '@/i18n';

interface Props {
  seo: SEOProps;
  lang?: Language;
}

const { seo, lang: propLang } = Astro.props;

// Get current language
const currentLang = propLang || getLangFromUrl(Astro.url);
const langData = languages[currentLang];

// Generate alternate language links for SEO
const alternateLinks = getAlternateLinks(Astro.url.pathname);

const defaultSEO: SEOProps = {
  title: 'TRACKWISE - Fintech & Media Infrastructure',
  description: 'Hong Kong Card Issuance, Fintech Core Development & Digital Music Distribution. We incorporate companies and build the financial & media rails they run on.',
  keywords: [
    'fintech',
    'card issuance',
    'hong kong',
    'fintech',
    'core fintech',
    'blockchain',
    'tokenization',
    'music distribution',
    'company incorporation',
    'digital payments',
    'BIN sponsorship',
    'prepaid cards',
    'stablecoin',
    'RWA tokenization',
  ],
  type: 'website',
  author: 'TRACKWISE LLC',
  twitterHandle: '@trackwise',
};

const meta = { ...defaultSEO, ...seo };
const canonicalURL = new URL(Astro.url.pathname, Astro.site || 'https://trackwise.com');

// Structured Data for Organization
const organizationSchema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: 'TRACKWISE LLC',
  legalName: 'TRACKWISE LLC',
  description: meta.description,
  url: 'https://trackwise.com',
  logo: 'https://trackwise.com/logo.png',
  image: 'https://trackwise.com/og-image.png',
  sameAs: [
    'https://twitter.com/trackwise',
    'https://linkedin.com/company/trackwise',
  ],
  address: {
    '@type': 'PostalAddress',
    addressLocality: 'Hong Kong',
    addressRegion: 'Hong Kong SAR',
    addressCountry: 'HK',
  },
  contactPoint: {
    '@type': 'ContactPoint',
    telephone: '+852-1234-5678',
    contactType: 'sales',
    availableLanguage: ['English', 'Chinese', 'Spanish', 'Portuguese'],
  },
  foundingDate: '2024',
  numberOfEmployees: {
    '@type': 'QuantitativeValue',
    value: '50+',
  },
};

// Structured Data for Services
const servicesSchema = {
  '@context': 'https://schema.org',
  '@type': 'Service',
  serviceType: 'Fintech Infrastructure',
  provider: {
    '@type': 'Organization',
    name: 'TRACKWISE',
  },
  areaServed: {
    '@type': 'GeoCircle',
    geoMidpoint: {
      '@type': 'GeoCoordinates',
      latitude: 22.3193,
      longitude: 114.1694,
    },
  },
  hasOfferCatalog: {
    '@type': 'OfferCatalog',
    name: 'Fintech Services',
    itemListElement: [
      {
        '@type': 'Offer',
        itemOffered: {
          '@type': 'Service',
          name: 'Card Issuance Program',
          description: 'Turnkey debit card programs with direct BIN sponsorship from Hong Kong',
        },
      },
      {
        '@type': 'Offer',
        itemOffered: {
          '@type': 'Service',
          name: 'Fintech Development',
          description: 'Custom fintech ledger systems with white-label UI/UX',
        },
      },
      {
        '@type': 'Offer',
        itemOffered: {
          '@type': 'Service',
          name: 'Blockchain Solutions',
          description: 'Smart contract development, RWA tokenization, and stablecoin infrastructure',
        },
      },
    ],
  },
};
---

<!DOCTYPE html>
<html lang={langData.locale} class="bg-tw-black">
  <head>
    <!-- Primary Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    
    <title>{meta.title}</title>
    <meta name="title" content={meta.title} />
    <meta name="description" content={meta.description} />
    {meta.keywords && <meta name="keywords" content={meta.keywords.join(', ')} />}
    {meta.author && <meta name="author" content={meta.author} />}
    
    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />
    
    <!-- Alternate Language Links (hreflang) for SEO -->
    {alternateLinks.map((alt) => (
      <link rel="alternate" hreflang={languages[alt.lang].locale.split('-')[0]} href={alt.href} />
    ))}
    <link rel="alternate" hreflang="x-default" href="https://trackwise.com/" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={meta.type || 'website'} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={meta.title} />
    <meta property="og:description" content={meta.description} />
    <meta property="og:image" content={meta.image || 'https://trackwise.com/og-image.png'} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content={`${meta.title} - TRACKWISE LLC`} />
    <meta property="og:site_name" content="TRACKWISE LLC" />
    <meta property="og:locale" content={langData.locale.replace('-', '_')} />
    {Object.entries(languages).filter(([code]) => code !== currentLang).map(([_, data]) => (
      <meta property="og:locale:alternate" content={data.locale.replace('-', '_')} />
    ))}

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={meta.title} />
    <meta name="twitter:description" content={meta.description} />
    <meta name="twitter:image" content={meta.image || 'https://trackwise.com/og-image.png'} />
    <meta name="twitter:image:alt" content={`${meta.title} - TRACKWISE LLC`} />
    {meta.twitterHandle && <meta name="twitter:site" content={meta.twitterHandle} />}
    <meta name="twitter:creator" content={meta.twitterHandle || '@trackwise'} />
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    
    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://code.iconify.design" />
    <link rel="preconnect" href="https://www.youtube.com" />
    
    <!-- DNS Prefetch -->
    <link rel="dns-prefetch" href="https://videos.pexels.com" />
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#050505" />
    <meta name="msapplication-TileColor" content="#050505" />
    
    <!-- Robots -->
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    
    <!-- Structured Data -->
    <script is:inline type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
    <script is:inline type="application/ld+json" set:html={JSON.stringify(servicesSchema)} />
    
    <!-- Iconify -->
    <script is:inline src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js" defer></script>
  </head>
  
  <body class="text-zinc-400 min-h-screen flex flex-col selection:bg-yellow-500 selection:text-black bg-tw-black overflow-x-hidden">
    <slot />
  </body>
</html>
