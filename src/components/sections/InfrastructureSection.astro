---
/**
 * FIDUBIT - Infrastructure Section
 * Fintech, Blockchain, and OTC services
 */
import ModuleTag from '@/components/ui/ModuleTag.astro';
import GlassPanel from '@/components/ui/GlassPanel.astro';
import { infrastructureServices } from '@/data/site';
import { getLangFromUrl, useTranslations } from '@/i18n';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Translated service content
const serviceTranslations: Record<string, Record<string, { title: string; description: string; features: string[] }>> = {
  en: {
    fintech: {
      title: 'Fintech Developer',
      description: 'Custom fintech ledger systems built for scale. We deliver white-label IBAN generation, Swift/SEPA integration, and high-performance transaction engines.',
      features: ['White-label UI/UX Design', 'API-First Architecture', 'Real-time Ledger Systems', 'Multi-tenant Infrastructure'],
    },
    blockchain: {
      title: 'Blockchain & Tokens',
      description: 'End-to-end Smart Contract development. Asset tokenization (RWA), Stablecoin issuance infrastructure, and secure custodial wallet integration.',
      features: ['RWA Tokenization', 'Stablecoin Infrastructure', 'Multi-sig Custody'],
    },
    otc: {
      title: 'Institutional OTC',
      description: 'Deep liquidity pools for high-volume fiat/crypto ramps with T+0 settlement. Direct market access to tier-1 liquidity providers.',
      features: ['T+0 Settlement', 'Deep Liquidity Access', 'Competitive Spreads'],
    },
  },
  es: {
    fintech: {
      title: 'Desarrollo Fintech',
      description: 'Sistemas de ledger fintech personalizados a escala. Generación de IBAN white-label, integración Swift/SEPA y motores de transacciones de alto rendimiento.',
      features: ['Diseño UI/UX White-label', 'Arquitectura API-First', 'Sistemas Ledger en Tiempo Real', 'Infraestructura Multi-tenant'],
    },
    blockchain: {
      title: 'Blockchain y Tokens',
      description: 'Desarrollo de Smart Contracts end-to-end. Tokenización de activos (RWA), infraestructura de Stablecoins e integración de wallets custodiales.',
      features: ['Tokenización RWA', 'Infraestructura Stablecoin', 'Custodia Multi-firma'],
    },
    otc: {
      title: 'OTC Institucional',
      description: 'Pools de liquidez profunda para rampas fiat/cripto de alto volumen con liquidación T+0. Acceso directo a proveedores de liquidez tier-1.',
      features: ['Liquidación T+0', 'Acceso a Liquidez Profunda', 'Spreads Competitivos'],
    },
  },
  pt: {
    fintech: {
      title: 'Desenvolvimento Fintech',
      description: 'Sistemas de ledger fintech personalizados para escala. Geração de IBAN white-label, integração Swift/SEPA e motores de transações de alto desempenho.',
      features: ['Design UI/UX White-label', 'Arquitetura API-First', 'Sistemas Ledger em Tempo Real', 'Infraestrutura Multi-tenant'],
    },
    blockchain: {
      title: 'Blockchain e Tokens',
      description: 'Desenvolvimento de Smart Contracts end-to-end. Tokenização de ativos (RWA), infraestrutura de Stablecoins e integração de wallets custodiais.',
      features: ['Tokenização RWA', 'Infraestrutura Stablecoin', 'Custódia Multi-assinatura'],
    },
    otc: {
      title: 'OTC Institucional',
      description: 'Pools de liquidez profunda para rampas fiat/cripto de alto volume com liquidação T+0. Acesso direto a provedores de liquidez tier-1.',
      features: ['Liquidação T+0', 'Acesso a Liquidez Profunda', 'Spreads Competitivos'],
    },
  },
  zh: {
    fintech: {
      title: '金融科技开发',
      description: '为规模化构建的定制金融科技账本系统。提供白标IBAN生成、Swift/SEPA集成和高性能交易引擎。',
      features: ['白标UI/UX设计', 'API优先架构', '实时账本系统', '多租户基础设施'],
    },
    blockchain: {
      title: '区块链与代币',
      description: '端到端智能合约开发。资产代币化(RWA)、稳定币发行基础设施和安全托管钱包集成。',
      features: ['RWA代币化', '稳定币基础设施', '多签托管'],
    },
    otc: {
      title: '机构OTC',
      description: '高容量法币/加密货币通道的深度流动性池，T+0结算。直接访问一级流动性提供商。',
      features: ['T+0结算', '深度流动性访问', '有竞争力的点差'],
    },
  },
  ar: {
    fintech: {
      title: 'تطوير التكنولوجيا المالية',
      description: 'أنظمة دفتر الأستاذ المالية المخصصة للتوسع. توليد IBAN ذو العلامة البيضاء وتكامل Swift/SEPA ومحركات معاملات عالية الأداء.',
      features: ['تصميم UI/UX ذو العلامة البيضاء', 'بنية API أولاً', 'أنظمة دفتر الأستاذ في الوقت الفعلي', 'بنية تحتية متعددة المستأجرين'],
    },
    blockchain: {
      title: 'البلوكتشين والتوكنات',
      description: 'تطوير العقود الذكية من البداية إلى النهاية. ترميز الأصول (RWA) وبنية إصدار العملات المستقرة وتكامل المحافظ الحفظية.',
      features: ['ترميز RWA', 'بنية العملات المستقرة', 'حفظ متعدد التوقيعات'],
    },
    otc: {
      title: 'OTC المؤسسي',
      description: 'مجمعات سيولة عميقة لقنوات العملات الورقية/المشفرة عالية الحجم مع تسوية T+0. وصول مباشر لمزودي السيولة من المستوى الأول.',
      features: ['تسوية T+0', 'الوصول إلى السيولة العميقة', 'فروق أسعار تنافسية'],
    },
  },
};

const currentTranslations = serviceTranslations[lang] || serviceTranslations.en;

const colorClasses = {
  blue: {
    bg: 'bg-blue-500/10',
    text: 'text-blue-500',
    border: 'border-blue-500/20',
    badge: 'border-blue-500/30 text-blue-400 bg-blue-500/5',
    hover: 'from-transparent to-blue-900/5',
  },
  purple: {
    bg: 'bg-purple-500/10',
    text: 'text-purple-500',
    border: 'border-purple-500/20',
    badge: 'border-purple-500/30 text-purple-400 bg-purple-500/5',
    hover: 'from-transparent to-purple-900/5',
  },
  green: {
    bg: 'bg-green-500/10',
    text: 'text-green-500',
    border: 'border-green-500/20',
    badge: 'border-green-500/30 text-green-400 bg-green-500/5',
    hover: 'from-transparent to-green-900/5',
  },
  yellow: {
    bg: 'bg-yellow-500/10',
    text: 'text-yellow-500',
    border: 'border-yellow-500/20',
    badge: 'border-yellow-500/30 text-yellow-400 bg-yellow-500/5',
    hover: 'from-transparent to-yellow-900/5',
  },
  fuchsia: {
    bg: 'bg-fuchsia-500/10',
    text: 'text-fuchsia-500',
    border: 'border-fuchsia-500/20',
    badge: 'border-fuchsia-500/30 text-fuchsia-400 bg-fuchsia-500/5',
    hover: 'from-transparent to-fuchsia-900/5',
  },
};
---

<section id="section-infra" class="relative border-b border-white/5 bg-fidubit-dark">
  <!-- Module Tag -->
  <div class="absolute top-0 right-0 p-4 z-20">
    <ModuleTag number="02" />
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
    {infrastructureServices.map((service, index) => {
      const colors = colorClasses[service.accentColor];
      const delayClass = index === 0 ? '' : index === 1 ? 'sys-delay-100' : 'sys-delay-200';
      
      return (
        <article 
          class:list={[
            "group relative border-r border-b lg:border-b-0 border-white/5 p-10 h-auto min-h-[420px]",
            "flex flex-col justify-between hover:bg-white/5 transition-colors sys-reveal sys-rise",
            delayClass
          ]}
        >
          <!-- Hover Gradient -->
          <div 
            class:list={[
              "absolute inset-0 bg-gradient-to-b opacity-0 group-hover:opacity-100 transition-opacity duration-500",
              colors.hover
            ]}
            aria-hidden="true"
          ></div>
          
          <!-- Dot Pattern Background -->
          <div class="absolute inset-0 dot-pattern" aria-hidden="true"></div>
          
          <!-- Header -->
          <div class="flex justify-between items-start relative z-10">
            <div class:list={["p-3 rounded-lg border", colors.bg, colors.text, colors.border]}>
              <iconify-icon icon={service.icon} width="28"></iconify-icon>
            </div>
            <span class="text-[10px] font-mono text-zinc-600">{service.tag}</span>
          </div>
          
          <!-- Content -->
          <div class="relative z-10 mt-auto">
            {(() => {
              const key = service.tag === 'INFRA_DEV' ? 'fintech' : service.tag === 'WEB3_LAYER' ? 'blockchain' : 'otc';
              const trans = currentTranslations[key];
              return (
                <>
                  <h3 class="text-xl font-medium text-white uppercase tracking-tight mb-3">
                    {trans.title}
                  </h3>
                  <p class="text-xs text-zinc-500 font-mono leading-relaxed mb-4">
                    {trans.description}
                  </p>
                  <ul class="space-y-2 mb-4">
                    {trans.features.map((feature) => (
                      <li class="flex items-center text-[10px] font-mono text-zinc-400 gap-2">
                        <iconify-icon icon="solar:check-circle-linear" class={colors.text}></iconify-icon>
                        {feature}
                      </li>
                    ))}
                  </ul>
                </>
              );
            })()}
            
            <!-- Badges -->
            {service.badges && (
              <div class="flex gap-2 mt-2 flex-wrap">
                {service.badges.map((badge) => (
                  <span class:list={["text-[9px] border px-2 py-1 rounded", colors.badge]}>
                    {badge}
                  </span>
                ))}
              </div>
            )}
            
            <!-- Liquidity Indicator (for OTC service) -->
            {service.tag === 'LIQUIDITY' && (
              <GlassPanel padding="sm" rounded="md" class="mt-4 border border-white/10">
                <div class="flex justify-between text-[10px] font-mono mb-1">
                  <span class="text-zinc-400">BTC/USDT</span>
                  <span class="text-green-400">Live</span>
                </div>
                <div class="w-full bg-zinc-800 h-1 rounded-full overflow-hidden">
                  <div class="w-2/3 h-full bg-green-500 animate-pulse"></div>
                </div>
              </GlassPanel>
            )}
          </div>
        </article>
      );
    })}
  </div>
</section>
